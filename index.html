<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>A to Z â€“ Daily Accounts (Realtime)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .tab-active { background: #0ea5e9; color:#fff }
    .hidden{display:none}
  </style>
</head>
<body class="bg-slate-100 min-h-screen">
  <div class="max-w-4xl mx-auto p-4">
    <header class="bg-white rounded-2xl shadow p-4 mb-4">
      <div class="flex justify-between items-center">
        <div>
          <h1 class="text-2xl font-bold text-slate-800">A to Z Packers & Movers</h1>
          <p class="text-slate-600">Daily Accounts (Firestore, realtime)</p>
        </div>
        <div class="text-right">
          <p id="todayText" class="text-sm text-slate-600"></p>
        </div>
      </div>
    </header>

    <!-- Auth -->
    <section id="authCard" class="bg-white rounded-2xl shadow p-4 mb-4">
      <h2 class="text-xl font-semibold mb-3">Sign in</h2>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
        <input id="email" type="email" placeholder="you@example.com" class="px-3 py-2 border rounded-xl"/>
        <input id="password" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" class="px-3 py-2 border rounded-xl"/>
        <div class="flex gap-2">
          <button id="btnSignIn" class="flex-1 bg-emerald-600 hover:bg-emerald-700 text-white font-semibold px-4 rounded-xl">Sign In</button>
          <button id="btnSignOut" class="flex-1 bg-slate-700 hover:bg-slate-800 text-white font-semibold px-4 rounded-xl hidden">Sign Out</button>
        </div>
      </div>
      <div class="mt-2 text-sm text-slate-500"><span id="whoami"></span></div>
      <div id="authMsg" class="text-sm text-rose-600 mt-1"></div>
    </section>

    <!-- App -->
    <section id="app" class="hidden">
      <div class="bg-white rounded-2xl shadow">
        <div class="flex">
          <button class="tab active flex-1 py-3 px-4 tab-active" data-tab="expenses">ðŸ“Š Expenses</button>
          <button class="tab flex-1 py-3 px-4" data-tab="income">ðŸ’° Income</button>
          <button class="tab flex-1 py-3 px-4" data-tab="totals">ðŸ§® Totals</button>
        </div>

        <!-- Expenses -->
        <div id="expenses" class="p-4">
          <form id="expenseForm" class="grid grid-cols-1 md:grid-cols-4 gap-3 mb-4">
            <input type="date" id="expenseDate" class="px-3 py-2 border rounded-xl"/>
            <select id="expenseCategory" class="px-3 py-2 border rounded-xl">
              <option value="">Category</option>
              <option>Fuel</option><option>Food</option><option>Stationery</option>
              <option>Repair</option><option>Labour</option><option>Misc</option>
            </select>
            <select id="expensePayment" class="px-3 py-2 border rounded-xl">
              <option value="">Mode</option><option>UPI</option><option>Cash</option>
              <option>Bank Transfer</option><option>Card</option>
            </select>
            <input type="number" id="expenseAmount" placeholder="Amount â‚¹" step="0.01" class="px-3 py-2 border rounded-xl"/>
            <input type="text" id="expenseDescription" placeholder="Description" class="md:col-span-3 px-3 py-2 border rounded-xl"/>
            <button class="md:col-span-4 bg-red-600 hover:bg-red-700 text-white font-semibold py-2 rounded-xl">Add Expense</button>
          </form>
          <div id="expensesList" class="space-y-2"></div>
        </div>

        <!-- Income -->
        <div id="income" class="p-4 hidden">
          <form id="incomeForm" class="grid grid-cols-1 md:grid-cols-4 gap-3 mb-4">
            <input type="date" id="incomeDate" class="px-3 py-2 border rounded-xl"/>
            <select id="incomeCategory" class="px-3 py-2 border rounded-xl">
              <option value="">Category</option>
              <option>Packers & Movers</option><option>Courier</option>
              <option>Ticket Booking</option><option>Other</option>
            </select>
            <select id="incomePayment" class="px-3 py-2 border rounded-xl">
              <option value="">Mode</option><option>UPI</option><option>Cash</option>
              <option>Bank Transfer</option><option>Card</option>
            </select>
            <input type="number" id="incomeAmount" placeholder="Amount â‚¹" step="0.01" class="px-3 py-2 border rounded-xl"/>
            <input type="text" id="incomeDescription" placeholder="Description" class="md:col-span-3 px-3 py-2 border rounded-xl"/>
            <button class="md:col-span-4 bg-green-600 hover:bg-green-700 text-white font-semibold py-2 rounded-xl">Add Income</button>
          </form>
          <div id="incomesList" class="space-y-2"></div>
        </div>

        <!-- Totals -->
        <div id="totals" class="p-6 hidden">
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
            <div class="bg-slate-50 rounded-xl p-4">
              <p class="text-slate-500 text-sm">Total Expenses</p>
              <p id="totalExpenses" class="text-2xl font-bold text-red-600">â‚¹0</p>
            </div>
            <div class="bg-slate-50 rounded-xl p-4">
              <p class="text-slate-500 text-sm">Total Income</p>
              <p id="totalIncome" class="text-2xl font-bold text-green-600">â‚¹0</p>
            </div>
            <div class="bg-slate-50 rounded-xl p-4">
              <p class="text-slate-500 text-sm">Net (Income âˆ’ Expenses)</p>
              <p id="netBalance" class="text-2xl font-bold text-blue-600">â‚¹0</p>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <script type="module">
    // Firebase SDKs
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore, collection, addDoc, onSnapshot, query, where, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // Your Firebase config (as provided)
    const firebaseConfig = {
      apiKey: "AIzaSyCieI_dFRI3K-TDNy0JFe02ndbT2ZO4bag",
      authDomain: "a-to-z-daily-account.firebaseapp.com",
      projectId: "a-to-z-daily-account",
      storageBucket: "a-to-z-daily-account.firebasestorage.app",
      messagingSenderId: "248686153632",
      appId: "1:248686153632:web:4399b9f34b0c97ae46dec5"
    };

    // Init
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db   = getFirestore(app);

    // UI helpers
    const todayISO = () => new Date().toISOString().split('T')[0];
    const fmtINR = (n) => new Intl.NumberFormat('en-IN', { style:'currency', currency:'INR' }).format(n);

    // Elements
    const authCard = document.getElementById("authCard");
    const appCard  = document.getElementById("app");
    const authMsg  = document.getElementById("authMsg");
    const whoami   = document.getElementById("whoami");
    const btnSignIn  = document.getElementById("btnSignIn");
    const btnSignOut = document.getElementById("btnSignOut");
    const expenseForm = document.getElementById("expenseForm");
    const incomeForm  = document.getElementById("incomeForm");
    const expensesList = document.getElementById("expensesList");
    const incomesList  = document.getElementById("incomesList");

    // Date defaults
    const today = todayISO();
    document.getElementById("todayText").textContent = new Date().toLocaleString('en-IN', { weekday:'long', year:'numeric', month:'long', day:'numeric' });
    document.getElementById("expenseDate").value = today;
    document.getElementById("incomeDate").value  = today;

    // Tabs
    document.querySelectorAll(".tab").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        document.querySelectorAll(".tab").forEach(b=>b.classList.remove("tab-active"));
        btn.classList.add("tab-active");
        ["expenses","income","totals"].forEach(id=>document.getElementById(id).classList.add("hidden"));
        document.getElementById(btn.dataset.tab).classList.remove("hidden");
      });
    });

    // Auth
    btnSignIn.addEventListener("click", async ()=>{
      authMsg.textContent = "";
      try {
        const email = document.getElementById("email").value.trim();
        const pass  = document.getElementById("password").value;
        await signInWithEmailAndPassword(auth, email, pass);
      } catch (e) {
        authMsg.textContent = e?.message || "Sign-in failed";
      }
    });
    btnSignOut.addEventListener("click", async ()=>{ await signOut(auth); });

    onAuthStateChanged(auth, (user)=>{
      if (user){
        whoami.textContent = `Logged in as ${user.email}`;
        authCard.classList.add("hidden");
        appCard.classList.remove("hidden");
        btnSignOut.classList.remove("hidden");
        startRealtime();
      } else {
        whoami.textContent = "";
        authCard.classList.remove("hidden");
        appCard.classList.add("hidden");
        btnSignOut.classList.add("hidden");
      }
    });

    // Add Expense
    expenseForm.addEventListener("submit", async (e)=>{
      e.preventDefault();
      const item = {
        date: document.getElementById("expenseDate").value || today,
        category: (document.getElementById("expenseCategory").value||"").trim(),
        payment:  (document.getElementById("expensePayment").value||"").trim(),
        description: (document.getElementById("expenseDescription").value||"").trim(),
        amount: parseFloat(document.getElementById("expenseAmount").value||"0"),
        updatedAt: serverTimestamp(),
        updatedBy: auth.currentUser?.email || auth.currentUser?.uid
      };
      if (!item.category || !item.payment || !item.amount) { alert("Category, Mode, Amount are required."); return; }
      await addDoc(collection(db,"expenses"), item);
      e.target.reset();
      document.getElementById("expenseDate").value = today;
    });

    // Add Income
    incomeForm.addEventListener("submit", async (e)=>{
      e.preventDefault();
      const item = {
        date: document.getElementById("incomeDate").value || today,
        category: (document.getElementById("incomeCategory").value||"").trim(),
        payment:  (document.getElementById("incomePayment").value||"").trim(),
        description: (document.getElementById("incomeDescription").value||"").trim(),
        amount: parseFloat(document.getElementById("incomeAmount").value||"0"),
        updatedAt: serverTimestamp(),
        updatedBy: auth.currentUser?.email || auth.currentUser?.uid
      };
      if (!item.category || !item.payment || !item.amount) { alert("Category, Mode, Amount are required."); return; }
      await addDoc(collection(db,"income"), item);
      e.target.reset();
      document.getElementById("incomeDate").value = today;
    });

    // Live listeners + totals
    function startRealtime(){
      // Listen only to today's entries so the list stays small
      const expQ = query(collection(db,"expenses"), where("date","==", today));
      const incQ = query(collection(db,"income"),   where("date","==", today));

      onSnapshot(expQ, (qs)=>{
        const items = qs.docs.map(d=> ({ id:d.id, ...d.data() }));
        renderList(expensesList, items, "expense");
        updateTotals();
      });

      onSnapshot(incQ, (qs)=>{
        const items = qs.docs.map(d=> ({ id:d.id, ...d.data() }));
        renderList(incomesList, items, "income");
        updateTotals();
      });
    }

    function renderList(container, arr, type){
      container.innerHTML = "";
      arr.sort((a,b)=> (a.updatedAt?.seconds||0) - (b.updatedAt?.seconds||0));
      arr.forEach(it=>{
        const row = document.createElement("div");
        row.className = "bg-white border rounded-xl px-3 py-2";
        row.innerHTML = `
          <div class="flex justify-between items-center">
            <div class="text-sm">
              <div class="font-semibold">${it.category || "-"}</div>
              <div class="text-slate-500">${new Date(it.date).toLocaleDateString('en-IN')} â€¢ ${it.payment||"-"}</div>
              <div class="text-slate-700">${it.description||""}</div>
            </div>
            <div class="text-right ${type==='expense'?'text-red-600':'text-green-600'} font-bold">
              ${fmtINR(Number(it.amount||0))}
            </div>
          </div>
        `;
        container.appendChild(row);
      });
      container.dataset[type+"Total"] = arr.reduce((s,x)=> s + Number(x.amount||0), 0);
    }

    function updateTotals(){
      const totalE = Number(document.getElementById("expensesList").dataset.expenseTotal||0);
      const totalI = Number(document.getElementById("incomesList").dataset.incomeTotal||0);
      document.getElementById("totalExpenses").textContent = fmtINR(totalE);
      document.getElementById("totalIncome").textContent   = fmtINR(totalI);
      document.getElementById("netBalance").textContent    = fmtINR(totalI - totalE);
    }
  </script>
</body>
</html>